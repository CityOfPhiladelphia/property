/**
 * @license RequireJS text 2.0.7 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

define("util",["jquery","underscore"],function(e,t){var n={};return n.loading=function(t){e("body").toggleClass("loading",t)},n.scrollToTop=function(){e(window).scrollTop(0)},n.formatNumber=function(e,t){return isNaN(e)||e===null?e:(t!==undefined&&(e=t?Math.round(e*100)/100:Math.round(e)),e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))},n.friendlyDate=function(e){var t=new Date(e);return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()},n}),define("models/property",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({settings:{apiHost:"http://services.phila.gov/OPA/v1.0/"},initialize:function(e){this.input=e.input||""},url:function(){return this.settings.apiHost+"account/"+encodeURIComponent(this.input.account)+"?format=json"},parse:function(e,t){var n=e.data.property;n.sales_information.sales_date=parseInt(n.sales_information.sales_date.replace(/[^-\d]/g,""),0);var r=["Not Applicable","1","New / Rehabbed","Above Average","Average","Below Average","Vacant","Sealed / Structurally Compliant"];return n.characteristics.exterior_condition=r[n.characteristics.exterior_condition],n}});return r}),define("collections/search-results",["jquery","underscore","backbone"],function(e,t,n){var r=n.Collection.extend({settings:{apiHost:"http://services.phila.gov/OPA/v1.0/",skip:0,limit:30},initialize:function(e,t){this.method=t.method||"",this.input=t.input||{},this.skip=t.skip||this.settings.skip,this.limit=t.limit||this.settings.limit},url:function(){var e=this.settings.apiHost;switch(this.method){case"address":e+="address/"+encodeURIComponent(this.input.address)+"/"+(this.input.unit?encodeURIComponent(this.input.unit):"");break;case"block":e+="block/"+encodeURIComponent(this.input.hundred+" "+this.input.street)+"/";break;case"intersection":e+="intersection/"+encodeURIComponent(this.input.street1)+"/"+encodeURIComponent(this.input.street2);break;case"comparable":e+="comparable/"+encodeURIComponent(this.input.eqid)+"/"+encodeURIComponent(this.input.bldgcd)}return e+="?format=json&limit="+this.limit+"&skip="+this.skip,e},parse:function(e,t){this.total=e.total,this.moreAvailable=e.total>this.length+e.data.properties.length;var n;for(n in e.data.properties)e.data.properties[n].sales_information.sales_date=parseInt(e.data.properties[n].sales_information.sales_date.replace(/[^-\d]/g,""),0);return e.data.properties},sync:function(e,r,i){var r=this,s=t.clone(i);i.success=function(e,t,n){e.status==="error"||e.data===undefined||e.data.properties===undefined||!e.data.properties.length?s.error({status:404}):s.success(e,n)},n.sync(e,r,i)}});return r}),define("text",["module"],function(e){var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h={},p=e.config&&e.config()||{};t={version:"2.0.7",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),p.onXhrComplete&&p.onXhrComplete(s,e))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),define("text!templates/home.html",[],function(){return'<div class="hero">\r\n    <h1>Property Search</h1>\r\n    <h3>You can use this application to search and compare property valuation data in the City of Philadelphia</h3>\r\n</div>\r\n<% if(data.noresults) { %>\r\n<div class="alert alert-error">No matches found for <code><%= _.compact(_.values(data.input)).join("</code> <code>") %></code>. <%= data.method !== "account" ? "For best results, try entering the account number of your property." : "" %> <a href="http://opa.phila.gov/opa.apps/Help/CitizenMain.aspx?sch=Ctrl2" target="_blank">Click here to submit an inquiry</a>.</div>\r\n<% } %>\r\n<div id="search-tabs" class="tabbable">\r\n    <ul class="nav nav-tabs">\r\n        <li class="active"><a href="#byAddress" data-toggle="tab">Address</a></li>\r\n        <li><a href="#byAccount" data-toggle="tab">Account</a></li>\r\n        <li><a href="#byBlock" data-toggle="tab">Block</a></li>\r\n        <li><a href="#byIntersection" data-toggle="tab">Intersection</a></li>\r\n    </ul>\r\n    <div class="tab-content row">\r\n        <div class="tab-pane active" id="byAddress">\r\n            <form data-method="address">\r\n                <div class="controls-row">\r\n                    <div class="control-group span4">\r\n                        <label for="address">Address</label>\r\n                        <input type="text" name="address" id="address" placeholder="ex. 1234 Market St" class="span4" autofocus>\r\n                    </div>\r\n                    <div class="control-group span2">\r\n                        <label for="unit">Unit</label>\r\n                        <input type="text" name="unit" id="unit" placeholder="ex. B" class="span2">\r\n                    </div>\r\n                </div>\r\n                <button class="btn btn-primary btn-large span6" type="submit"><i class="icon-search icon-white"></i> Search</button>\r\n            </form>\r\n        </div>\r\n        <div class="tab-pane" id="byAccount">\r\n            <form data-method="account">\r\n                <div class="controls-row">\r\n                    <div class="control-group span6">\r\n                        <label for="account">Account #</label>\r\n                        <input type="text" name="account" id="account" placeholder="ex. 883309000" class="span6">\r\n                    </div>\r\n                </div>\r\n                <button class="btn btn-primary btn-large span6" type="submit"><i class="icon-search icon-white"></i> Search</button>\r\n            </form>\r\n        </div>\r\n        <div class="tab-pane" id="byBlock">\r\n            <form data-method="block">\r\n                <div class="controls-row">\r\n                    <div class="control-group span2">\r\n                        <label for="hundred">Hundred</label>\r\n                        <input type="text" name="hundred" id="hundred" placeholder="ex. 1200" class="span2">\r\n                    </div>\r\n                    <div class="control-group span4">\r\n                        <label for="street">Street</label>\r\n                        <input type="text" name="street" id="street" placeholder="ex. Market St" class="span4">\r\n                    </div>\r\n                </div>\r\n                <button class="btn btn-primary btn-large span6" type="submit"><i class="icon-search icon-white"></i> Search</button>\r\n            </form>\r\n        </div>\r\n        <div class="tab-pane" id="byIntersection">\r\n            <form data-method="intersection">\r\n                <div class="controls-row">\r\n                    <div class="control-group span3">\r\n                        <label for="street1">Street 1</label>\r\n                        <input type="text" name="street1" id="street1" placeholder="ex. 12th St" class="span3">\r\n                    </div>\r\n                    <div class="control-group span3">\r\n                        <label for="street2">Street 2</label>\r\n                        <input type="text" name="street2" id="street2" placeholder="ex. Market St" class="span3">\r\n                    </div>\r\n                </div>\r\n                <button class="btn btn-primary btn-large span6" type="submit"><i class="icon-search icon-white"></i> Search</button>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<hr>\r\n\r\n<footer>By using this application you agree to its <a href="#disclaimer">Terms of Use</a>.</footer>'}),define("views/home",["jquery","underscore","backbone","text!templates/home.html"],function(e,t,n,r){var i=n.View.extend({className:"home",initialize:function(){t.bindAll(this,"render","onSubmit"),this.template=t.template(r),this.title="Property Search"},events:{"submit form":"onSubmit"},render:function(){return this.$el.html(this.template({method:this.options.method||null,input:this.options.input||null,noresults:this.options.noresults||!1})),this},onSubmit:function(t){t.preventDefault();var r=e(t.currentTarget).data("method");switch(r){case"address":var i=t.currentTarget.address,s=i.value,o=t.currentTarget.unit.value;if(!s)return e(i).focus();n.history.navigate("/address/"+s+(o?"/"+o:""),{trigger:!0});break;case"account":var u=t.currentTarget.account,a=u.value;if(!a)return e(u).focus();n.history.navigate("/account/"+a,{trigger:!0});break;case"block":var f=t.currentTarget.hundred,l=f.value,c=t.currentTarget.street,h=c.value;if(!l)return e(f).focus();if(!h)return e(c).focus();n.history.navigate("/block/"+l+"/"+h,{trigger:!0});break;case"intersection":var p=t.currentTarget.street1,d=p.value,v=t.currentTarget.street2,m=v.value;if(!d)return e(p).focus();if(!m)return e(v).focus();n.history.navigate("/intersection/"+d+"/"+m,{trigger:!0})}},sanitize:function(e,t){return typeof e=="string"?e.replace(t==="actnum"?/[^\d]/g:/[^\w\d\s-]/g,""):""}});return i}),define("text!templates/disclaimer.html",[],function(){return'<div class="hero">\r\n    <h1>Property Search</h1>\r\n    <h3>You can use this application to search and compare property valuation data in the City of Philadelphia</h3>\r\n</div>\r\n\r\n<div class="scrollable">\r\n<h3>Terms of Use</h3>\r\n<p>The Office of Property Assessment of the City of Philadelphia (OPA) makes every effort to produce and publish on this site the most accurate and current infomrmation available to it. Our ownership records are based on deeds as recorded with the City of Philadelphia Department of Records (DOR), and we revise these records for currency as often as we are able. You are responsible, however, for verifying the accuracy of the information on this site by referring to the corresponding deed(s).</p>\r\n\r\n<p>The OPA is not an abstract company and we do not determine who has the better title to a property if the public records conflict as to ownership. The information on this site is not intended to indicate the quality of title or priority of interest in any property, and you are advised not to rely on it for that purpose.</p>\r\n\r\n<p>The market values and assessed values published on this site may not reflect changes made since the last update in our database. We do not have any information as to whether taxes have been paid for any particular property.</p>\r\n\r\n<p>The additional City of Philadelphia terms and conditions below all apply to the information on this OPA site and to your access to and use of this information and the site.</p>\r\n\r\n<h3>Disclaimer</h3>\r\n<p>The City of Philadelphia and the OPA (collectively, the City) make no warranty or representation whatsoever, express or implied, with respect to the quality, content, accuracy, completeness, currency, freedom from computer virus, suitability for any particular purpose, or non-infringement of proprietary rights, of any of the information published on this site, or any of the design, text, graphics, images, pages, interfaces, links, software, or other materials, documents, and items contained in or displayed or published on this site. All such items and materials are provided on an "as is" basis, and you are fully and solely responsible for your use of them and for any results or consequences of your use. In many cases, they have been compiled from a variety of sources, including sources beyond the control of the City of Philadelphia, and are subject to change without notice from the City. Except as stated below, commercial use (including but not limited to sale to others) is prohibited without the prior written permission of the City. To the extent you use, apply, or implement this information in your own information system or other setting, or otherwise for your own purposes, you do so at your own risk. In no event shall the City, the OPA, the City\'s other agencies, or the officers, employees, agents, or representatives of any of the foregoing be liable for any direct, indirect, special, punitive, incidental, exemplary or consequential damages arising your accessing or using the site or any information displayed on the site, or otherwise arising from the site or from anything contained in or displayed on the site. Nothing contained in or displayed on this site constitutes or is intended to constitute legal advice by the City or any of its agencies, officers, employees, agents, attorneys, or representatives.</p>\r\n\r\n<h3>External sites</h3>\r\n<p>This site may contain links to other sites on the Internet that are operated by parties other than the City and have information that may be of interest to our users. The City has no control over these sites and is not responsible for their content or for the availability of the sites or their content. Our links to these sites are not an endorsement or recommendation of the sites or of any commercial or other products or services that may be advertised or available on them; nor does the City necessarily support the views or facts presented on them. Questions and concerns regarding the content of any linked external site should be addressed directly to the administrator of the external site.</p>\r\n\r\n<h3>Copyright, trademarks and servicemarks</h3>\r\n<p>Servicemarks and trademarks contained in or displayed on the site, and the contents of linked sites operated by third parties, are the property of their respective owners. All other design, information, text, graphics, images, pages, interfaces, links, software, and other items and materials contained in or displayed on this site, and the selection and arrangements thereof, are the property of the City of Philadelphia. All rights are reserved. Permission to copy electronically and to print information from the site is for personal use only, or to be shared with other persons on the condition that all information copied, printed, and/or shared is without cost to the recipients and exactly as printed on the site, without any addition or modification.</p>\r\n\r\n<h3>Communications through the site</h3>\r\n<p>In no event shall any communication made through the e-mail, messaging or other communications functions of any City web site constitute legal or other notice to the City, the OPA, any of the City\'s other agencies, or to any of the officers, employees, agents, or representatives of the OPA or the City, including but not limited to (i) legal notice required by federal, state, or local laws, rules, or regulations with respect to any existing or potential claim or cause of action against the City or any of its agencies, officers, employees, agents, or representatives; (ii) any form of notice required pursuant to the OPA\'s regulations or policies or any federal, state, or local law applying to the OPA; or (iii) any form of notice required pursuant to any document issued by the OPA.</p>\r\n\r\n<h3>Miscellaneous</h3>\r\n<p>The foregoing terms and conditions and all disputes arising under them shall be governed, construed and decided in accordance with the laws of the Commonwealth of Pennsylvania. The City reserves the right to revise and otherwise change the foregoing terms and conditions at anytime and without notice. Headings are for convenience only and in no way define, limit, extend or describe the intent of any provision of these Terms of Use and Disclaimer.</p>\r\n</div>\r\n<a href="#" class="btn btn-large btn-success accept">I Accept</a>'}),define("views/disclaimer",["jquery","underscore","backbone","text!templates/disclaimer.html"],function(e,t,n,r){var i=n.View.extend({className:"disclaimer",initialize:function(){this.template=r,this.title="Disclaimer"},events:{"click .accept":"onAccept"},render:function(){return this.$el.html(this.template),this},onAccept:function(t){e.cookie("accepted-disclaimer",!0)}});return i}),define("text!templates/property.html",[],function(){return'<h1>\r\n    <%= data.property.full_address %>\r\n    <% if($.trim(data.property.unit)) { %>\r\n        <span class="unit">Unit: <%= data.property.unit.replace(/^0+/, "") %></span>\r\n    <% } %>\r\n    <small>Account # <%= data.property.account_number %></small>\r\n</h1>\r\n<div class="row">\r\n    <div class="span6">\r\n        <div class="widget">\r\n            <div class="widget-header">\r\n                <i class="icon-book"></i>\r\n                <h3>Account Information</h3>\r\n            </div>\r\n            <div class="widget-content">\r\n                <div class="row">\r\n                    <div class="span3">\r\n                        <ul class="nav nav-list">\r\n                            <li class="nav-header">Owner<%= data.property.ownership.length > 1 ? "s" : "" %></li>\r\n                            <li>\r\n                                <% _.each(data.property.ownership, function(owner) { %>\r\n                                    <%= owner.name %><br>\r\n                                <% }); %>\r\n                            </li>\r\n                            <li class="nav-header">Mailing Address</li>\r\n                            <li>\r\n                                <% var addresses = _.uniq(data.property.ownership, null, function(x) { return JSON.stringify({street: x.street, city: x.city, state: x.state, zip: x.zip}); }); %>\r\n                                <% _.each(addresses, function(owner) { %>\r\n                                    <address><%= [owner.street, [owner.city, owner.state].join(" "), owner.zip].join("<br>") %></address>\r\n                                <% }); %>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                    <div class="span2">\r\n                        <ul class="nav nav-list">\r\n                            <li class="nav-header">Property Unit</li>\r\n                            <li><%= data.property.unit || "None" %></li>\r\n                            <li class="nav-header">Property Zip</li>\r\n                            <li><%= data.property.zip %>\r\n                            <li class="nav-header">Sale Date</li>\r\n                            <li><%= data.util.friendlyDate(data.property.sales_information.sales_date) %></li>\r\n                            <li class="nav-header">Sale Price</li>\r\n                            <li>$<%= data.util.formatNumber(data.property.sales_information.sales_price || 0) %></li>\r\n                            <li class="nav-header">Homestead</li>\r\n                            <li><%= data.property.characteristics.homestead ? "Yes" : "No" %></li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="span6">\r\n        <div class="widget">\r\n            <div class="widget-header">\r\n                <i class="icon-home"></i>\r\n                <h3>Property Characteristics</h3>\r\n            </div>\r\n            <div class="widget-content">\r\n                <div class="row">\r\n                    <div class="span3">\r\n                        <ul class="nav nav-list">\r\n                            <li class="nav-header">Land Area</li>\r\n                            <li><%= data.util.formatNumber(data.property.characteristics.land_area || 0) %> SqFt</li>\r\n                            <li class="nav-header">Improvement Area</li>\r\n                            <li><%= data.util.formatNumber(data.property.characteristics.improvement_area || 0) %> SqFt</li>\r\n                            <li class="nav-header">Improvement Description</li>\r\n                            <li><%= data.property.characteristics.description %></li>\r\n                        </ul>\r\n                    </div>\r\n                    <div class="span2">\r\n                        <ul class="nav nav-list">\r\n                            <li class="nav-header">Beginning Point</li>\r\n                            <li><%= data.property.characteristics.beginning_point %></li>\r\n                            <li class="nav-header">Exterior Condition</li>\r\n                            <li><%= data.property.characteristics.exterior_condition %></li>\r\n                            <li class="nav-header">Zoning</li>\r\n                            <li><%= data.property.characteristics.zoning %></li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<% if(data.property.proposed_valuation !== undefined &&  ! _.isEmpty(data.property.proposed_valuation)) { %>\r\n<div class="row">\r\n    <div class="span12">\r\n        <div class="widget widget-table">\r\n            <div class="widget-header">\r\n                <i class="icon-th-large"></i>\r\n                <h3>Proposed Valuation</h3>\r\n            </div>\r\n            <div class="widget-content flipper">\r\n                <table class="table table-striped table-bordered">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Year</th>\r\n                            <th>Market Value</th>\r\n                            <th>Assessed Land (Taxable)</th>\r\n                            <th>Assessed Improvement (Taxable)</th>\r\n                            <th>Assessed Land (Exempt)</th>\r\n                            <th>Assessed Improvement (Exempt)</th>\r\n                            <th>Total Assessment</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <tr>\r\n                            <td><%= data.property.proposed_valuation.certification_year %></td>\r\n                            <td>$<%= data.util.formatNumber(data.property.proposed_valuation.market_value) %></td>\r\n                            <td>$<%= data.util.formatNumber(data.property.proposed_valuation.land_taxable) %></td>\r\n                            <td>$<%= data.util.formatNumber(data.property.proposed_valuation.improvement_taxable) %></td>\r\n                            <td>$<%= data.util.formatNumber(data.property.proposed_valuation.land_exempt) %></td>\r\n                            <td>$<%= data.util.formatNumber(data.property.proposed_valuation.improvement_exempt) %></td>\r\n                            <td>$<%= data.util.formatNumber(data.property.proposed_valuation.land_taxable + data.property.proposed_valuation.improvement_taxable) %></td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<% } %>\r\n<div class="row">\r\n    <div class="span12">\r\n        <div class="widget widget-table">\r\n            <div class="widget-header">\r\n                <i class="icon-th-list"></i>\r\n                <h3>Certified Valuation History</h3>\r\n            </div>\r\n            <div class="widget-content flipper">\r\n                <table class="table table-striped table-bordered">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Year</th>\r\n                            <th>Market Value</th>\r\n                            <th>Assessed Land (Taxable)</th>\r\n                            <th>Assessed Improvement (Taxable)</th>\r\n                            <th>Assessed Land (Exempt)</th>\r\n                            <th>Assessed Improvement (Exempt)</th>\r\n                            <th>Total Assessment</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                <% _.each(data.property.valuation_history, function(valuation) { %>\r\n                        <tr>\r\n                            <td><%= valuation.certification_year %></td>\r\n                            <td>$<%= data.util.formatNumber(valuation.market_value) %></td>\r\n                            <td>$<%= data.util.formatNumber(valuation.land_taxable) %></td>\r\n                            <td>$<%= data.util.formatNumber(valuation.improvement_taxable) %></td>\r\n                            <td>$<%= data.util.formatNumber(valuation.land_exempt) %></td>\r\n                            <td>$<%= data.util.formatNumber(valuation.improvement_exempt) %></td>\r\n                            <td>$<%= data.util.formatNumber(valuation.land_taxable + valuation.improvement_taxable) %></td>\r\n                        </tr>\r\n                <% }) %>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\nNote: The Department of Revenue is responsible for collecting real estate taxes.  Please visit the <a href="http://www.phila.gov/revenue" target="_blank">Department of Revenue Website</a> for information regarding the billing, collecting and accounting of real estate taxes or call 215-686-6442.\r\n<br><br>\r\n<a href="#" class="btn btn-large"><i class="icon-chevron-left"></i> New Search</a>\r\n<a href="http://www.phila.gov/revenue/RealEstateTax/Default.aspx?txtBRTNo=<%= data.property.account_number %>" class="btn btn-large btn-info" target="_blank">View Tax Balances</a>\r\n<a href="http://opa.phila.gov/opa.apps/Help/CitizenMain.aspx?sch=Ctrl2&s=1&url=search&id=<%= data.property.property_id %>" class="btn btn-large btn-warning" target="_blank">Submit an Inquiry</a>'}),define("views/property",["jquery","underscore","backbone","util","text!templates/property.html"],function(e,t,n,r,i){var s=n.View.extend({className:"property",initialize:function(){this.template=t.template(i)},render:function(){return this.$el.html(this.template({property:this.model.toJSON(),util:r})),this.title=this.model.get("full_address"),this}});return s}),define("text!templates/search-results.html",[],function(){return'<h3>Multiple Properties Found</h3>\r\n<p><%= data.total %> results found</p>\r\n\r\n<table class="table table-striped table-bordered results">\r\n    <thead>\r\n        <tr>\r\n            <th>Address</th>\r\n            <th class="hidden-phone">Owner(s)</th>\r\n            <th class="hidden-phone">Sale Details</th>\r\n            <th class="hidden-phone">Market Value</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody></tbody>\r\n</table>\r\n\r\n<button class="btn btn-large btn-block more" type="button" data-loading-text="Loading" data-error-text="Error">More</button>\r\n<br><br><a href="#" class="btn btn-large"><i class="icon-chevron-left"></i> New Search</a>'}),define("text!templates/search-results-row.html",[],function(){return'<td>\r\n    <a href="#account/<%= data.searchResultsRow.account_number %>"><%= data.searchResultsRow.full_address %><% if(data.searchResultsRow.unit) { %> <span class="unit">Unit: <%= data.searchResultsRow.unit.replace(/^0+/, "") %></span><% } %></a>\r\n</td>\r\n<td class="hidden-phone">\r\n    <%= _.pluck(data.searchResultsRow.ownership, "name").join("<br>") %>\r\n</td>\r\n<td class="hidden-phone">\r\n    <%= data.util.friendlyDate(data.searchResultsRow.sales_information.sales_date) %>\r\n    <br>\r\n    $<%= data.util.formatNumber(data.searchResultsRow.sales_information.sales_price || 0) %>\r\n</td>\r\n<td class="hidden-phone">\r\n    $<%= data.util.formatNumber(data.searchResultsRow.valuation_history[0].market_value || 0) %>\r\n</td>'}),define("views/search-results-row",["jquery","underscore","backbone","util","text!templates/search-results-row.html"],function(e,t,n,r,i){var s=n.View.extend({tagName:"tr",initialize:function(){this.template=t.template(i)},render:function(){return this.$el.html(this.template({searchResultsRow:this.model.toJSON(),util:r})),this}});return s}),define("views/search-results",["jquery","underscore","backbone","text!templates/search-results.html","views/search-results-row"],function(e,t,n,r,i){var s=n.View.extend({className:"search-results",initialize:function(){t.bindAll(this,"onClickMore"),this.template=t.template(r),this.collection.on("add",this.addRow,this),this.title="Multiple Properties Found"},events:{"click .more":"onClickMore"},render:function(){var e;return this.$el.html(this.template({searchResults:this.collection.toJSON(),total:this.collection.total})),e=this.$(".results"),this.collection.each(function(t){e.append((new i({model:t})).render().el)}),this.checkMoreButton(),this},addRow:function(e){this.$(".results tbody").append((new i({model:e})).render().el),this.checkMoreButton()},onClickMore:function(t){t.preventDefault();var n=e(t.currentTarget);n.button("loading"),this.collection.skip=this.collection.skip+this.collection.limit,this.collection.fetch({remove:!1,success:function(){n.button("reset")},error:function(){n.button("error")}})},checkMoreButton:function(){this.$(".more").toggle(this.collection.moreAvailable)}});return s}),define("text!templates/error.html",[],function(){return'<h1>Error</h1>\r\n<%= data.message %>\r\n<br><br>\r\n<a href="#" class="btn btn-large"><i class="icon-chevron-left"></i> New Search</a>\r\n<a href="#" rel="reload" class="btn btn-large btn-info"><i class="icon-repeat icon-white"></i> Try Again</a>'}),define("views/error",["jquery","underscore","backbone","text!templates/error.html"],function(e,t,n,r){var i=n.View.extend({className:"error",initialize:function(){this.template=t.template(r),this.message=this.options.message,this.title="Error"},events:{'click [rel="reload"]':"reload"},render:function(){return this.$el.html(this.template({message:this.message||""})),this},reload:function(e){e.preventDefault(),window.location.reload()}});return i}),define("router",["jquery","underscore","backbone","util","models/property","collections/search-results","views/home","views/disclaimer","views/property","views/search-results","views/search-results-row","views/error"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=n.Router.extend({routes:{"":"home","account/:account":"account","address/:address(/:unit)":"address","block/:hundred/:street":"block","intersection/:street1/:street2":"intersection","comparable/:eqid/:bldgcd":"comparable",disclaimer:"disclaimer","*path":"home"},initialize:function(){window._gaq=window._gaq||[]},showView:function(t){this.currentView&&this.currentView.$el.detach(),e("#main").empty().append(t.render().el),document.title=t.title!==undefined&&t.title?t.title:e("title").text(),this.currentView=t,r.scrollToTop(),this.logPageView()},home:function(){if(e.cookie("accepted-disclaimer")){var t=new o;this.showView(t)}else n.history.navigate("disclaimer",{trigger:!0})},account:function(e){var t=this,n={account:decodeURIComponent(e)},s=new i({input:n});r.loading(!0),s.fetch({success:function(e,n,i){r.loading(!1);var s=new a({model:e});t.showView(s)},error:function(e,i,s){r.loading(!1),t.error(e,i,s,"An error occurred while finding the property in the database. Please try again.",{method:"account",input:n,noresults:!0})}})},address:function(e,t){var n=this,i={address:decodeURIComponent(e),unit:t?decodeURIComponent(t):null},o=new s(null,{input:i,method:"address"});r.loading(!0),o.fetch({success:function(e,t,i){r.loading(!1);if(e.length===1)n.navigate("account/"+e.at(0).get("account_number"),{trigger:!0,replace:!0});else{var s=new f({collection:e});n.showView(s)}},error:function(e,t,s){r.loading(!1),n.error(e,t,s,"An error occurred while verifying the address. Please try again.",{method:"address",input:i,noresults:!0})}})},block:function(e,t){var n=this,i={hundred:decodeURIComponent(e),street:decodeURIComponent(t)},o=new s(null,{input:i,method:"block"});r.loading(!0),o.fetch({success:function(e,t,i){r.loading(!1);var s=new f({collection:e});n.showView(s)},error:function(e,t,s){r.loading(!1),n.error(e,t,s,"An error occurred while verifying the address. Please try again.",{method:"block",input:i,noresults:!0})}})},intersection:function(e,t){var n=this,i={street1:decodeURIComponent(e),street2:decodeURIComponent(t)},o=new s(null,{input:i,method:"intersection"});r.loading(!0),o.fetch({success:function(e,t,i){r.loading(!1);var s=new f({collection:e});n.showView(s)},error:function(e,t,s){r.loading(!1),n.error(e,t,s,"An error occurred while verifying the address. Please try again.",{method:"intersection",input:i,noresults:!0})}})},comparable:function(e,t){var n=this,i={eqid:decodeURIComponent(e),bldgcd:decodeURIComponent(t)},o=new s(null,{input:i,method:"comparable"});r.loading(!0),o.fetch({success:function(e,t,i){r.loading(!1);var s=new f({collection:e});n.showView(s)},error:function(e,t,s){r.loading(!1),n.error(e,t,s,"An error occurred while verifying the address. Please try again.",{method:"comparable",input:i,noresults:!0})}})},error:function(e,t,n,r,i){var s=typeof e.url=="function"?e.url():e.url;this.logError(typeof t=="object"&&t.status!==undefined?t.status:"N/A",s);if(typeof i=="object"&&typeof t=="object"&&t.status>=400&&t.status<500){var u=new o(i);this.showView(u)}else{var a=new c({message:r||"An error occurred. Please try again."});this.showView(a)}},disclaimer:function(){var e=new u;this.showView(e)},logPageView:function(){var e=n.history.getFragment();window._gaq.push(["_trackPageview","/"+e]),window.DEBUG&&console.log("Google Analytics",e)},logError:function(e,t){window._gaq.push(["_trackEvent","ErrorCaught",e+"",t]),window.DEBUG&&console.log("Google Analytics Error",e,t)}});return h}),function(e){typeof define=="function"&&define.amd?define("jquery-cookie",["jquery"],e):e(jQuery)}(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{e=decodeURIComponent(e.replace(t," "))}catch(n){return}try{return u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g,u=e.cookie=function(t,s,a){if(s!==undefined&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires=="number"){var f=a.expires,l=a.expires=new Date;l.setDate(l.getDate()+f)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{},h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("="),m=r(v.shift()),g=v.join("=");if(t&&t===m){c=o(g,s);break}!t&&(g=o(g))!==undefined&&(c[m]=g)}return c};u.defaults={},e.removeCookie=function(t,n){return e.cookie(t)===undefined?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),define("app",["jquery","underscore","backbone","router","jquery-bootstrap","jquery-cookie"],function(e,t,n,r){window.DEBUG=!1,t.templateSettings.variable="data",e.ajaxSetup({cache:!0,timeout:15e3}),n.ajax=function(){return!e.support.cors&&arguments.length?(arguments[0].cache="true",arguments[0].timeout=15e3,arguments[0].dataType="jsonp",n.$.ajax.apply(n.$,arguments)):n.$.ajax.apply(n.$,arguments)};var i={init:function(){this.router=new r,n.history.start()}};return i}),window.requirejs=window.requirejs||{},function(e){e.config({baseUrl:"scripts/",paths:{jquery:["//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min","lib/jquery.min"],underscore:["//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min","lib/underscore-min"],backbone:["//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min","lib/backbone-min"],"jquery-bootstrap":["//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/js/bootstrap.min","lib/bootstrap.min"],"jquery-jsonp":"lib/jquery-jsonp.min","jquery-cookie":"lib/jquery.cookie"},shim:{underscore:{exports:"_"},backbone:{exports:"Backbone",deps:["jquery","underscore"]},"jquery-jsonp":{deps:["jquery"]},"jquery-bootstrap":{deps:["jquery"]},"jquery-cookie":{deps:["jquery"]}}}),require(["app"],function(e){e.init()})}(window.requirejs),define("main",function(){});